# 2020.3.13小程序商城笔记
## 1.根据已知的siteuser_id获取该用户全部的订单信息.其中部分信息需要二次获取，如下：
### 1).payment_id:根据它我们需要获取用户的支付方式（paymethod）  
### 2).order_id:根据它我们需要获取订单详情（order_item）  
### 3).addressbook_id:根据它，我们需要获取该订单的地址簿（address_book）
## 以上三部分的信息都需要调用系统的api接口，相关接口总结如下:  
### 1).根据订单id获取订单详情：await context.async_call('post/order_ccode/get_detail')  
## 2.将产品添加至购物车，首先已知的是产品的id。根据这个id需要获取到的信息如下  
> (1)product_uuid  
> (2)category_uuid
> (3)order_uuid  
> (4)cart_uuid  
> (5)price  
> (6)count（默认是1）  

### 其中1，2，5理论上都可以从产品表中获取，6在学习阶段暂且按照1来算。  
### order_uuid可以根据需求而定，在此阶段就让它为null。而购物车的uuid需要斟酌。  
### 理论上当用户注册时，就应该自动为他创建一个购物车的数据。但是目前我显然做不到。  
### 因此我只能每次都判断一下当前用户是否有购物车记录，有则引用，没有就创建后再引用。  
### 在完成的过程中，我遇到了一个比较没想到的问题。我根据当前登录用户id查询到该用户在购物车表中所对应的购物车uuid。  
### 然而我将所有整理好的数据通过字典形式添加到订单子项的表中，报错说购物车uuid数据有问题。  
### 检查再三以后，才发现原来获取到的uuid居然不是str类型的。这是我没想通的，以后在遇到类似问题需要格外小心。

### 接下来需要完成的事项总结如下：
> 1.根据siteuser_id，获得当前用户的cart_uuid  
> 2.通过cart_uuid获取当前用户的所有产品子项，其中的信息包括（product_uuid,count,price）  
> 3.通过每一个子项中的product_uuid再获取这个子项产品的name,image  
> 4.最后将name,image,count,price这四个比较基础的值组成字典，将字典一个一个组成列表，将这个列表送到前端。  
> 5.在前端遍历展示  

### 我遇到的几个坑：
> 1.原本我一直习惯通过repo.filter()这种方式过滤，但后来遇到了一个特殊情况。
> 我在数据表中不太清楚的情况下删除了几行数据，但是不记得这回事了。然后我遍历这个表中的数据发现莫名其妙
> 多了很多数据表中根本没有的数据，在测试环境中需要用active()方法进行过滤，否则就会将一些已经删除（假性删除）的数据获取到。
> 2.发起支付的微信官方api似乎无法测试，因此本人不知从何下手，为了不浪费太多时间，我决定直接开始学习组合模块的基础应用
